# This software is provided "as is" and any express or implied warranties, including,
# but not limited to, the implied warranties of merchantability and fitness for a
# particular purpose are disclaimed. In no event shall the authors or copyright holders
# be liable for any claim, damages or other liability, whether in an action of contract,
# tort or otherwise, arising from, out of or in connection with the software or the use
# or other dealings in the software.
#
# The software is provided under the European Union Public Licence (EUPL) version 1.2;
# you may not use this file except in compliance with the License. You may obtain a copy
# of the License at:
#
#     https://joinup.ec.europa.eu/collection/eupl/eupl-text-eupl-12
#
# Unless required by applicable law or agreed to in writing, software distributed under
# the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied. See the License for the specific language governing
# permissions and limitations under the License.

{{#MORIO_DOCS}}
about: |-
  A filebeat module for Linux systems

  This collects log data from the Samba package.

  If the logs are to be sent to a Splunk ecosystem, you can set the MORIO_SAMBA_SPLUNK_INDEX_NAME Morio variable to specify the name of the Splunk index to use.
{{/MORIO_DOCS}}

{{^MORIO_DOCS}}

- type: log 
  id: samba_everything
  paths:
    - /var/log/samba/log.*
  multiline.pattern: '^\['
  multiline.negate: true
  multiline.match: after
  multiline.skip_newline: true

  processors:
    - add_fields:
        target: morio
        fields:
          module: {{ MORIO_MODULE_NAME }}

    - add_fields:
        target: host
        fields:
          id: {{ MORIO_CLIENT_UUID }}

    - add_fields:
        target: debug
        fields:
          iteration: "SA-AD"

    - add_fields:
        target: service
        fields:
          name: "Samba"

    - dissect:
        field: "message"
        tokenizer: "[%{temp_timestamp}, %{log.level}] %{service.module.file}:%{service.module.line}(%{service.function})%{event.message}"
        target_prefix: ''
        ignore_missing: true
        ignore_failure: true
        overwrite_keys: true
        trim_values: left # as the Syslog level can have spaces

    - timestamp:
        field: temp_timestamp
        layouts:
          - '2006/01/02 15:04:05.999999'
        timezone: Local
    - drop_fields:
        fields: temp_timestamp

    {{#MORIO_SAMBA_SPLUNK_INDEX_NAME }}
    - add_fields:
        target: splunk
        fields:
          index: {{ MORIO_SAMBA_SPLUNK_INDEX_NAME }}
    {{/MORIO_SAMBA_SPLUNK_INDEX_NAME }}

{{/MORIO_DOCS}}

