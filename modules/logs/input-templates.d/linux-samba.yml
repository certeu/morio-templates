{{#MORIO_DOCS}}
about: |-
  A filebeat module for Linux systems

  This collects log data from the Samba package.
vars:
  defaults:
    MORIO_SAMBA_LOGS_PATHS: "['/var/log/samba/log.*']"
    MORIO_SAMBA_SPLUNK_INDEX_NAME: false
  local:
    MORIO_SAMBA_LOGS_PATHS: A (glob) list of paths from which to collect Samba logs
    MORIO_SAMBA_SPLUNK_INDEX_NAME: If the logs are to be sent to a Splunk ecosystem, you can set this Morio variable to add a `splunk.index` field to the data, with the value of the variable.
{{/MORIO_DOCS}}

{{^MORIO_DOCS}}

- type: filestream
  id: samba_everything
  multiline.pattern: '^\['
  multiline.negate: true
  multiline.match: after
  multiline.skip_newline: true
  paths: {{{MORIO_SAMBA_LOGS_PATHS}}}

  processors:
    - add_fields:
        target: morio
        fields:
          module: {{ MORIO_MODULE_NAME }}

    - add_fields:
        target: morio
        fields:
          module_version: "SA-AA"

    - add_fields:
        target: host
        fields:
          id: {{ MORIO_CLIENT_UUID }}

    - add_fields:
        target: service
        fields:
          name: "Samba"

    - add_id: null

    - dissect:
        field: "message"
        tokenizer: "[%{timestamp}, %{log.level}] %{service.module.file}:%{service.module.line}(%{service.function})%{event.message}"
        target_prefix: ''
        ignore_missing: true
        ignore_failure: true
        overwrite_keys: true
        trim_values: left # as the Syslog level can have spaces

    - timestamp:
        field: timestamp
        layouts:
          - '2006/01/02 15:04:05.999999'
        timezone: Local

    {{#MORIO_SAMBA_SPLUNK_INDEX_NAME }}
    - add_fields:
        target: splunk
        fields:
          index: {{ MORIO_SAMBA_SPLUNK_INDEX_NAME }}
    {{/MORIO_SAMBA_SPLUNK_INDEX_NAME }}

{{/MORIO_DOCS}}

