{{#MORIO_DOCS}}
about: |-
  A filebeat module for Linux systems

  This collects log data from the Docker package when the logs are in tab-delimited text format.

  The path used as a default for docker logs is /var/lib/docker/containers/*/*-json.log.
  You can override the default value with the MORIO_DOCKER_TEXT_LOGS_PATHS environment variable. If you do so, please make sure that it is formatted as a YAML directive starting by four (4) space characters and a dash as in the example below:
  ```
  # sudo morio vars set MORIO_DOCKER_TEXT_LOGS_PATHS '    - /var/lib/docker/containers/*/*-json.log'
  ```
  If you wish to pass several log paths, you can do so by constructing a multiline string. To include another path, add a newline character and start a new line with four (4) space characters and a dash as in the example below:
  ```
  # sudo morio vars set MORIO_DOCKER_TEXT_LOGS_PATHS '    - /var/lib/docker/containers/*/*-json.log
    - /var/lib/docker2/containers/*/*-json.log'
  ```

  If the logs are to be sent to a Splunk ecosystem, you can set the MORIO_DOCKER_SPLUNK_INDEX_NAME Morio variable to specify the name of the Splunk index to use.
{{/MORIO_DOCS}}

{{^MORIO_DOCS}}

- type: log 
  id: docker_everything
  paths:
{{#MORIO_DOCKER_TEXT_LOGS_PATHS}}
{{MORIO_DOCKER_TEXT_LOGS_PATHS}}
{{/MORIO_DOCKER_TEXT_LOGS_PATHS}}
{{^MORIO_DOCKER_TEXT_LOGS_PATHS}}
    - /var/lib/docker/containers/*/*-json.log
{{/MORIO_DOCKER_TEXT_LOGS_PATHS}}

  processors:
    - add_fields:
        target: morio
        fields:
          module: {{ MORIO_MODULE_NAME }}

    - add_fields:
        target: host
        fields:
          id: {{ MORIO_CLIENT_UUID }}

    - add_fields:
        target: debug
        fields:
          iteration: "DO-AE"

    - add_fields:
        target: service
        fields:
          name: "Docker"

    - dissect:
        field: "message"
        tokenizer: "%{temp_timestamp}\t%{client.ip}\t%{client.id}\t%{client.session_name}\t%{server.ip}\t%{event.message}"
        target_prefix: ''
        ignore_missing: true
        ignore_failure: true
        overwrite_keys: true

    - replace:
        fields:
          - field: "event.message"
            pattern: "\\t"
            replacement: "  "
        ignore_missing: true
        fail_on_error: false

    - timestamp:
        field: temp_timestamp
        layouts:
          - '2006-01-02 15:04:05 -0700'
        timezone: Local
    - drop_fields:
        fields: temp_timestamp

    {{#MORIO_DOCKER_SPLUNK_INDEX_NAME }}
    - add_fields:
        target: splunk
        fields:
          index: {{ MORIO_DOCKER_SPLUNK_INDEX_NAME }}
    {{/MORIO_DOCKER_SPLUNK_INDEX_NAME }}

{{/MORIO_DOCS}}

